### 产品需求规格书：宏观波段HODL策略（Macro-Wave HODL）

 

#### 需求概述

产品名称：宏观波段HODL交易策略  

版本：1.1  

需求目的：提供一个完整、可执行的交易策略方案。通过参数定义、代理逻辑、决策流程和执行机制，确保策略可直接转化为代码实现。焦点包括数据源标准化、阈值设置、风控措施，以及性能监控指标。适用于加密货币长期持有者，目标是实现年化回报率提升，同时将最大回撤控制在规定范围内。  

适用场景：加密市场宏观周期驱动的投资，针对BTC和ETH。  

依赖组件：AI代理系统、实时数据API（如CoinGlass for ETF数据、Glassnode for on-chain数据）、交易执行引擎（支持TWAP）。新增：外部功能模块接口，用于资金变动交互。  

开发优先级：高（核心策略）。  

测试要求：回测期不少于5年历史数据；压力测试包括熊市和牛市场景；模拟执行延迟和数据缺失。  

 

#### 1. 策略哲学 (Strategy Philosophy)

此策略为宏观驱动的自适应积累与退出机制。策略通过多维度信号融合，在宏观顺风期分批积累，在逆风或过热期主动暂停或部分减仓，以最小化成本并捕捉长期复利。包含周期适应性，允许策略根据市场波动率动态调整积累速度。

 

#### 2. 关键参数 (Key Parameters)

参数支持配置化和动态调整。所有参数均可通过配置文件（如JSON）加载，便于测试。

 

- **资产标的 (Assets)**: BTC (权重60%)、ETH (权重40%)。支持扩展至SOL等高Beta资产，但默认禁用。

- **决策周期 (Decision Frequency)**: 每4小时（UTC时间同步）。如果市场波动率（基于VIX或Crypto Fear & Greed Index）>80，缩短至每2小时。

- **单次积累资金比例 (Accumulation Size)**: 总资本的0.5%（默认）。动态调整：如果Conviction Score >85，增加至0.75%；如果<55，减少至0.25%。

- **信号权重 (Signal Weights)**:

 - MacroAgent: 40%

 - OnChainAgent: 40%

 - TAAgent: 20%

 权重可季度审视，根据回测表现动态优化（e.g., 如果OnChain信号历史准确率>75%，权重上调5%）。

- **其他参数**:

 - 最小资本门槛 (Min Capital Threshold): $10,000（低于此值，策略暂停以避免手续费侵蚀）。

 - 波动率阈值 (Volatility Threshold): 基于ATR(14)的30日平均值>5%时，激活高频模式。

 - 性能指标 (Performance Metrics): 追踪Sharpe Ratio（目标>1.5）、Max Drawdown（<30%）。新增：Sortino Ratio（目标>2.0，下行风险调整回报）、Calmar Ratio（目标>0.5，年化回报/最大回撤）。

 

#### 3. 所需专家AI代理 (Required Specialist Agents)

代理模块化，每个代理独立运行，支持异步调用和缓存（缓存有效期1小时）。代理输出标准化为JSON格式，便于核心逻辑解析。数据源验证逻辑：如果数据缺失>20%，代理返回中性分数（0.0）并日志警告。每个代理将全部输入数据提供给LLM进行处理，以生成分数。

 

- **MacroAgent (宏观经济代理)**:

 - **输入**（标准化数据源）:

   - 每日ETF净流入/流出（来源: CoinGlass API或Farside Investors）。

   - CME期货持仓报告（来源: CME Group API，每周更新）。

   - 联邦基金利率期货隐含降息概率（来源: CME FedWatch Tool API）。

   - 全球流动性指标（如M2增长率，从FRED API）。

 - **处理逻辑**: 将全部数据输入LLM，基于规则评分：正向指标（如ETF流入>0）加分，负向（如持仓过高）减分。优化：LLM额外评估宏观趋势持续性（如降息概率趋势），以提升分数鲁棒性，避免短期噪声影响。

 - **输出**: -1.0 to +1.0 的宏观环境分数（e.g., +0.8表示强劲牛市）。附带置信度（0-1）和解释字符串（e.g., "ETF流入强劲，降息概率80%"）。

 

- **OnChainAgent (链上数据代理)**:

 - **输入**（标准化数据源）:

   - MVRV Z-Score（来源: Glassnode API）。

   - NVT Ratio（来源: CryptoQuant API）。

   - 交易所净流量（来源: Chainalysis或Nansen API）。

   - 长期持有者持仓变化（来源: Glassnode，定义为>1年持有地址）。

   - 活跃地址数和Gas费趋势（来源: Etherscan/Bitcoin Blockchain Explorer）。

 - **处理逻辑**: 将全部数据输入LLM，进行Z-Score标准化处理：>3为过热（-分数），<0为低估（+分数）。使用阈值规则结合趋势分析。优化：LLM整合持有波段概念（如长期持有者比例），强化对市场周期的敏感度，提高分数对熊市低估信号的响应。

 - **输出**: -1.0 to +1.0 的链上健康度分数。异常检测（e.g., 如果净流量>历史均值2SD，强制-0.5）。

 

- **TAAgent (技术分析代理)**:

 - **输入**（标准化数据源）:

   - BTC/ETH 周线图表的EMA(21)与EMA(55)相对位置（来源: TradingView API或Binance Historical Data）。

   - 周线RSI(14)值。

   - MACD Histogram和Bollinger Bands宽度（衡量趋势强度和波动）。

 - **处理逻辑**: 将全部数据输入LLM，进行EMA金叉为+分数，死叉为-分数；RSI>70过买（-），<30过卖（+）。优化：LLM增加对波动宽度的权重调整，使分数更适应高波动环境下的趋势确认，减少假信号。

 - **输出**: -1.0 to +1.0 的长期趋势强度分数。趋势持续天数作为权重 multiplier。

 

#### 4. 决策逻辑 (Decision Logic)

逻辑使用状态机设计（e.g., 当前状态：积累/持有/暂停），便于代码实现（如Python状态模式）。决策周期内执行以下步骤，支持伪代码直接转换。即使策略判断结果是持仓不动，也需执行资金变动环节。

 

- **步骤1: 数据采集与信号调用**:

 - 通过内部API异步调用3个代理，超时阈值30秒。

 - 如果任何代理失败，返回默认中性分数（0.0）并通知管理员。

 

- **步骤2: 计算信念分数 (Conviction Score)**:

 - Formula: Conviction Score = (MacroAgent_Score * 0.4) + (OnChainAgent_Score * 0.4) + (TAAgent_Score * 0.2)

 - 归一化: Score = (Raw_Score + 1) * 50  # 映射到0-100

 - 应用波动率调整：如果波动率>阈值，Score *= 0.8（保守化）。优化：新增情绪过滤，如果Crypto Fear & Greed Index<20，Score下调10%以增强保守性。

 

- 步骤3: 生成交易指令 (基于阈值决策树):

 - IF Conviction Score > 70 (强信念区):

   - 指令: {ACTION: "BUY", ASSET: "BTC" or "ETH" (基于当前价格相对EMA位置选择更高Beta资产), AMOUNT_PERCENT: 0.5% (动态调整)}

   - 解释: "强劲牛市信号，执行积累。"

   - 如果连续3周期>70，触发“加速积累” (AMOUNT_PERCENT += 0.25%)。优化：连续周期阈值调整为4，以减少过度积累风险。

 - ELSE IF 40 <= Conviction Score <= 70 (中性持有区):

   - 指令: {ACTION: "HOLD", ASSET: "NONE", AMOUNT_PERCENT: 0}

   - 解释: "市场稳定，观察中。"

   - 如果持仓>80%资本，评估部分减仓（如果RSI>75，卖出0.25%）。优化：减仓触发RSI阈值上调至80，以避免频繁操作。

 - ELSE IF Conviction Score < 40 (风险警示区):

   - 指令: {ACTION: "PAUSE", ASSET: "NONE", AMOUNT_PERCENT: 0}

   - 解释: "风险信号，暂停。"

   - 如果<20，触发“防御减仓”：{ACTION: "SELL", AMOUNT_PERCENT: 1%}，以锁定利润或减少暴露。优化：防御阈值调整为<25，以更快响应熊市信号。

 - 输出格式: JSON对象，便于交易引擎解析。

 

- 步骤4: 资金变动环节 (在执行调仓前，无论交易指令类型):

 - 计算当前总价值（当前持仓价值 + 闲置资金），发送给外部功能模块（通过API或指定接口）。

 - 外部功能模块输入一个资金变动指令（增加或减少多少资金，可能为0）。

 - 根据指令调整总资本：在本次调仓中执行变动（e.g., 如果增加资金，添加到闲置资金池；如果减少，优先从闲置资金提取，若不足则从持仓中减仓）。然后，使用更新后的总资本计算交易指令中的AMOUNT_PERCENT。

 

- **步骤5: 日志与监控**:

 - 记录所有分数、指令、资金变动和解释到数据库（e.g., MongoDB）。

 - 如果Score变化>20% vs 上周期，发送警报。

 

#### 5. 执行与风控 (Execution & Risk Management)

执行自动化，风控多层化，包括主动止盈和多样化机制。资金变动环节已在决策逻辑中集成，确保调仓前总资本更新。

 

- **执行方式**:

 - 买入/卖出: 使用TWAP算法，在指令后30分钟内分10批执行（通过Binance或Coinbase API）。优化：分批数量调整为15，以进一步平滑执行。

 - 资产分配: BTC/ETH按权重再平衡，每月1日执行。

 - 滑点监控，如果执行价格偏离>1%，中止并重试。

 

- **核心风控**:

 - **内置决策风控**: Conviction Score <40的暂停/减仓作为第一层，避免顶部建仓。

 - **止盈/止损**: 相对止盈：如果持仓浮盈>50%，自动卖出20%；无硬止损，但如果总回撤>20%，强制暂停1周。优化：止盈阈值下调至>40%，以更好地捕捉复苏期。

 - **多样化与限额**: 单一资产暴露不超过总资本60%；总杠杆禁用（纯现货）。

 - **外部风控**: 集成黑天鹅检测（e.g., 如果Crypto Fear Index<20，强制HOLD）。每日VaR计算（95%置信，目标<5%）。

 - **监控与审计**: 实时仪表盘显示Score历史、持仓和绩效；季度审计回测 vs 实际表现，如果Sharpe<1.0，触发参数优化。

 

#### 实施与集成需求

- **技术栈建议**: Python (核心逻辑)、FastAPI (代理接口)、Celery (异步任务)、PostgreSQL (数据存储)。

- **接口定义**:

 - 输入: 用户资本、API密钥。新增：外部功能模块接口（e.g., REST API端点，用于发送总价值并接收资金变动指令）。

 - 输出: 交易日志、绩效报告。

- **潜在风险与缓解**: 数据延迟（使用备用源）；模型漂移（每月审视代理逻辑）。新增：外部模块响应超时（默认变动量0）。

- **下一步行动**: 开发原型（2周）、回测验证（1周）、上线测试（1月）。

 

#### 附录：关键名词与算法解释

- **HODL**: 加密货币社区术语，意为“持有”（Hold On for Dear Life），指长期持有资产而不轻易出售。

- **TWAP (Time-Weighted Average Price)**: 时间加权平均价格算法，将订单分成小块，在指定时间内均匀执行，以减少市场冲击。

- **Conviction Score**: 信念分数，一个加权计算的分数，用于量化市场信心水平，范围0-100。

- **ETF (Exchange-Traded Fund)**: 交易所交易基金，一种跟踪资产（如BTC）的投资工具，其资金流入/流出反映市场情绪。

- **CME (Chicago Mercantile Exchange)**: 芝加哥商品交易所，提供加密期货数据，如持仓报告。

- **MVRV Z-Score**: 市场价值与实现价值比率的Z分数，用于评估资产是否被高估或低估（>3过热，<0低估）。

- **NVT Ratio (Network Value to Transactions Ratio)**: 网络价值与交易比率，类似于P/E比，用于判断链上活动是否支持当前估值。

- **EMA (Exponential Moving Average)**: 指数移动平均线，短期EMA(21)与长期EMA(55)交叉用于识别趋势（金叉看涨，死叉看跌）。

- **RSI (Relative Strength Index)**: 相对强度指数，范围0-100，>70过买，<30过卖，用于检测超买/超卖。

- **MACD (Moving Average Convergence Divergence)**: 移动平均收敛散度指标，用于趋势强度分析，通过直方图显示动量。

- **Bollinger Bands**: 布林带，由中轨（SMA）和上下轨道组成，宽度表示波动率。

- **ATR (Average True Range)**: 平均真实波动幅度，用于测量市场波动率。

- **Sharpe Ratio**: 夏普比率，衡量风险调整后回报（回报率减无风险率除以标准差）。

- **Max Drawdown**: 最大回撤，从峰值到谷底的最大损失百分比。

- **VaR (Value at Risk)**: 在险价值，估算在给定置信水平下可能的最大损失。

- **Crypto Fear & Greed Index**: 加密恐惧与贪婪指数，综合市场情绪指标，<20极端恐惧，>80极端贪婪。

- **LLM (Large Language Model)**: 大型语言模型，用于处理输入数据并生成分数，通过提示工程实现规则-based决策。

- **Sortino Ratio**: 索提诺比率，类似于Sharpe但仅考虑下行偏差，强调下行风险调整。

- **Calmar Ratio**: 卡尔玛比率，年化回报除以最大回撤，用于评估策略在回撤期的表现。

- **高频模式**: 是指一种动态调整机制，用于应对市场高波动期。具体来说：

• 激活条件：当市场波动率超过阈值时触发。具体阈值基于ATR(14)的30日平均值>5%，或市场波动率指标（如VIX或Crypto Fear & Greed Index）>80。
• 主要变化：策略的决策周期从默认的每4小时缩短至每2小时。这允许策略更频繁地评估信号（如Conviction Score），从而更快响应市场变化，提高适应性。
• 目的：在高波动环境中增强保守性，例如通过波动率调整公式（Score *= 0.8）降低信念分数，减少激进行为（如过度积累），并更好地规避风险。
• 影响：激活后，代理调用和交易指令生成更频繁，但每次操作规模（如积累资金比例）仍受动态调整限制，确保不引入额外风险。
 

指标清单 指标02-L.csv