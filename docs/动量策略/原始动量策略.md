产品需求规格书：混合智能动量引擎 (Hybrid Intelligence Momentum Engine - H.I.M.E.)
需求概述
产品名称： 混合智能动量引擎 (H.I.M.E.)
版本： 2.0 (融合版)
需求目的： 提供一个完整、可部署的AI增强型动量交易策略。本策略以经过验证的、规则驱动的技术分析系统为执行核心，并引入一个先进的AI宏观制度过滤器（Regime Filter）作为动态决策中枢。目标是结合量化规则的稳定性与AI的适应性，在激进追求Alpha的同时，智能规避系统性风险。
适用场景： BTC/ETH/SOL永续合约的高频（小时级）波段交易。
依赖组件： AI代理系统、实时数据API（涵盖您系统已有的全部数据源）、高性能交易执行引擎。
开发优先级： 极高（旗舰策略）。
测试要求： 必须进行滚动窗口（Walk-Forward）优化回测，并对AI模型的历史判断进行交叉验证。
1. 策略哲学 (Strategy Philosophy)
规则为骨，AI为魂 (Rules as the Skeleton, AI as the Soul)。
本策略的设计哲学是“分层决策”，将交易任务解耦，让每个组件做最擅长的事：
执行骨架 (The Skeleton): 底层是一个确定性的、规则驱动的技术分析引擎，完全基于您提供的“经典量化动量策略”。它负责回答“出现什么技术形态可以交易？(What to trade?)”以及“如何精确计算仓位和止损？(How to execute?)”。这个骨架确保了策略的稳定性和可预测性。
决策灵魂 (The Soul): 上层是一个AI驱动的宏观制度过滤器 (Regime Filter Agent)。它通过综合分析市场情绪、宏观流动性和衍生品结构，持续评估当前市场的“健康度”和“风险偏好”。它负责回答“现在这个时间点，适合交易吗？(IF we should trade?)”以及“如果适合，我们应该多激进？(How aggressive should we be?)”。
最终效果： 这是一个懂得“看天吃饭”的精密交易机器。它使用经典的动量信号进行交易，但只有在AI大脑判断“天气晴朗”时才会全力出击；在“天气多云”时则会小心翼翼；在“暴风雨”来临前，它会选择待在车库里，从而有效避免在不适合动量策略的市场环境中产生不必要的亏损。
2. 关键参数 (Key Parameters)
参数分为“基础参数”和由AI动态调制的“有效参数”。
资产标的 (Assets): BTC, ETH, SOL。
决策评估周期 (Decision Interval): 15分钟。
时间框架 (Timeframes): 交易周期 (15m), 趋势周期 (60m)。
基础风险参数 (Base Risk Parameters):
Base_Risk_PCT (单笔基础风险): 0.5%
Base_Leverage (基础杠杆): 5x
Base_TP_RR (基础风险回报比): 2.0
AI调制器 (AI Modulators):
Regime Score: 由AI代理输出的0.0 (极度危险) 到 1.0 (极度健康) 的市场制度分数。
有效参数计算 (Effective Parameter Calculation):
IF Regime Score < 0.3 (危险区):
Effective_Risk_PCT = 0 (暂停开新仓)
IF 0.3 <= Regime Score < 0.7 (谨慎区):
Effective_Risk_PCT = Base_Risk_PCT * 0.5 (风险减半)
Effective_Leverage = Base_Leverage * 0.8 (杠杆降低)
Effective_TP_RR = Base_TP_RR
IF Regime Score >= 0.7 (机会区):
Effective_Risk_PCT = Base_Risk_PCT * 1.2 (风险加码)
Effective_Leverage = Base_Leverage * 1.5 (杠杆提高)
Effective_TP_RR = Base_TP_RR * 1.25 (目标放远)
技术指标参数 (Technical Parameters):
完全采纳您“经典量化动量策略”中的参数表，如 EMA_fast=20, EMA_slow=60, sl_atr_mult=2.0 等。
3. 所需专家AI代理 (Required Specialist Agent)
RegimeFilterAgent (市场宏观制度过滤器):
核心任务: 取代简单的宏观过滤规则，对当前市场环境的“交易适宜度”进行综合评分。
输入 (复用您系统已有数据):
宏观流动性: 每日ETF净流入/流出、美元指数(DXY)、联邦基金利率期货隐含降息概率。
市场情绪: Crypto Fear & Greed Index。
衍生品健康度: BTC/ETH/SOL的资金费率、持仓量变化趋势、期货溢价率。
链上价值评估: MVRV Z-Score。
处理逻辑 (LLM驱动):
LLM的核心任务是理解这些指标之间的复杂和非线性关系。例如：
普通规则： 资金费率过高 -> 危险。
LLM逻辑： 资金费率过高，但伴随着强劲的ETF现货净流入和健康的链上活动 -> 这可能是牛市初期的健康杠杆增加，而非泡沫，风险反而较低。
LLM通过对这类多维情景的学习和推理，输出一个比任何单一阈值都更准确的环境判断。
输出:
Regime Score：0.0 to 1.0 的浮点数。
Explanation: 一段自然语言解释，如“宏观流动性改善，但衍生品市场杠杆过高，市场处于中性谨慎状态，Regime Score=0.6”。
4. 决策逻辑 (Decision Logic)
每15分钟K线收盘后，严格按以下顺序执行：
步骤1: AI制度评估 (The "IF"):
调用 RegimeFilterAgent 获取当前的全局 Regime Score 和解释。
风控总开关: 如果 Regime Score < 0.3，则中止本周期的所有开仓评估，直接进入步骤5（现有仓位管理）。
步骤2: TA信号生成 (The "WHAT"):
对于每个资产 (BTC, ETH, SOL)，完全按照“经典量化动量策略”的**第三节（信号生成）**执行。
1. 趋势过滤 (EMA_fast vs EMA_slow)
2. 动量确认 (MACD + RSI)
3. 成交量等辅助确认
此步骤的输出是纯粹的、未经调制的交易信号，如：“SOL，多头进场信号”。
步骤3: AI调制与仓位计算 (The "HOW MUCH"):
如果步骤2生成了交易信号（例如“SOL多头进场”），则进入本步骤。
根据步骤1的 Regime Score，计算出Effective_Risk_PCT、Effective_Leverage和Effective_TP_RR。
使用这些**“有效参数”，并完全按照“经典量化动量策略”的第四节（仓位管理）和第五节（止盈、出场）**来计算最终的交易指令细节：
R = Equity * Effective_Risk_PCT
SL = sl_atr_mult * ATR
PositionSize_units = R / SL
P_TP = EntryPrice + (SL * Effective_TP_RR)
步骤4: 生成最终指令 (JSON Output):
将计算出的所有参数（资产、方向、数量、止损价、止盈价、杠杆）打包成一个标准的JSON交易指令，准备发往交易引擎。
步骤5: 现有仓位管理:
无论本周期是否开新仓，都对所有持仓进行检查。
应用“经典量化动量策略”第五节中的所有出场规则（ATR尾随止损、时间止损等）。
AI增强-主动风险降级: 如果持仓期间 Regime Score 急剧恶化（例如2小时内从0.8跌至0.4），可触发预警或自动将部分浮盈仓位的止损上移至更积极的位置。
5. 执行与风控 (Execution & Risk Management)
执行方式:
采用“经典量化动量策略”第八节的建议，优先使用限价单入场，成交后立即挂载OCO止损止盈单。
风控总线:
完全继承“经典量化动量策略”第七节中定义的风控总线，这是策略的最后一道防线，其优先级最高。
max_open_trades
daily_drawdown_limit (4%)
circuit_breaker (连续5笔止损后暂停)
max_drawdown_total (15%)
AI的 Regime Score 是在此风控框架之前的主动、预判式风控，两者互为补充。
6. 实施与集成需求 (Implementation & Integration)
数据层: 确保您系统已有的数据接口能够稳定地为 RegimeFilterAgent 提供所需的宏观、链上及衍生品数据。
AI模型层: 部署 RegimeFilterAgent 作为一个独立的微服务，策略主逻辑通过API调用它获取 Regime Score。
策略逻辑层: 主策略代码实现上述的“决策逻辑”五步流程。代码结构上，TA信号生成模块和仓位计算模块应与AI调用模块解耦。
风控与执行层: 实现强大的风控总线，并与交易所的订单执行API可靠对接。
监控与日志:
策略日志: 记录每笔决策的所有细节（TA信号、Regime Score、有效参数、最终指令）。
AI监控: 建立一个独立的仪表盘，追踪 Regime Score 的历史变化及其输入的各项宏观指标，用于评估AI的判断是否合理。
总结：
这份 H.I.M.E. 策略方案，将您提供的严谨、可靠的量化交易框架作为坚实的地基和骨架，然后为其安装了一个由AI驱动的、能够感知和适应市场环境的“智能大脑”。这使得策略不仅能够执行高胜率的交易模式，更重要的是，它知道何时应该执行，何时应该等待，从而在长期内实现更平滑、更强大的资本增长曲线。