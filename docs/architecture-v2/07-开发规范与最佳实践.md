# å¼€å‘è§„èŒƒä¸æœ€ä½³å®è·µ

> ç‰ˆæœ¬: 2.0  
> æ›´æ–°æ—¥æœŸ: 2025-11-05  
> ç›®æ ‡: ç»Ÿä¸€å›¢é˜Ÿå¼€å‘æ ‡å‡†ï¼Œæå‡ä»£ç è´¨é‡

---

## ä¸€ã€é¡¹ç›®ç»“æ„è§„èŒƒ

### 1.1 åç«¯ç›®å½•ç»“æ„

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                 # FastAPIåº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py               # é…ç½®ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                    # APIè·¯ç”±å±‚
â”‚   â”‚   â”œâ”€â”€ v1/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚   â”‚   â”œâ”€â”€ portfolio.py
â”‚   â”‚   â”‚   â”œâ”€â”€ strategies.py
â”‚   â”‚   â”‚   â””â”€â”€ agents.py
â”‚   â”‚
â”‚   â”œâ”€â”€ agents/                 # Agentå®ç°
â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â”œâ”€â”€ macro_agent.py
â”‚   â”‚   â”œâ”€â”€ onchain_agent.py
â”‚   â”‚   â”œâ”€â”€ ta_agent.py
â”‚   â”‚   â””â”€â”€ workflows/
â”‚   â”‚       â””â”€â”€ strategy_workflow.py
â”‚   â”‚
â”‚   â”œâ”€â”€ services/               # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ auth_service.py
â”‚   â”‚   â”œâ”€â”€ portfolio_service.py
â”‚   â”‚   â”œâ”€â”€ trading_service.py
â”‚   â”‚   â””â”€â”€ llm_service.py
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                 # SQLAlchemyæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”œâ”€â”€ strategy.py
â”‚   â”‚   â”œâ”€â”€ trade.py
â”‚   â”‚   â””â”€â”€ portfolio.py
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/                # Pydantic Schema
â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”œâ”€â”€ strategy.py
â”‚   â”‚   â””â”€â”€ agent.py
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                   # æ ¸å¿ƒåŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ security.py         # JWT/OAuth
â”‚   â”‚   â”œâ”€â”€ database.py         # DBè¿æ¥
â”‚   â”‚   â””â”€â”€ cache.py            # Redis
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                  # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ indicators.py       # æŠ€æœ¯æŒ‡æ ‡è®¡ç®—
â”‚   â”‚   â”œâ”€â”€ validators.py       # æ•°æ®éªŒè¯
â”‚   â”‚   â””â”€â”€ formatters.py
â”‚   â”‚
â”‚   â””â”€â”€ tasks/                  # å®šæ—¶ä»»åŠ¡
â”‚       â”œâ”€â”€ scheduler.py
â”‚       â”œâ”€â”€ data_collector.py
â”‚       â””â”€â”€ strategy_executor.py
â”‚
â”œâ”€â”€ tests/                      # æµ‹è¯•
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ fixtures/
â”‚
â”œâ”€â”€ alembic/                    # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ .env.example
â””â”€â”€ README.md
```

### 1.2 å‰ç«¯ç›®å½•ç»“æ„ï¼ˆä¿æŒç°æœ‰ï¼‰

```
src/
â”œâ”€â”€ App.tsx
â”œâ”€â”€ main.tsx
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚   â”œâ”€â”€ StrategyMarketplace.tsx
â”‚   â”œâ”€â”€ Exploration.tsx
â”‚   â””â”€â”€ ui/                     # Radix UIç»„ä»¶
â”‚
â”œâ”€â”€ hooks/                      # è‡ªå®šä¹‰Hooks
â”‚   â”œâ”€â”€ usePortfolio.ts
â”‚   â”œâ”€â”€ useWebSocket.ts
â”‚   â””â”€â”€ useAuth.ts
â”‚
â”œâ”€â”€ stores/                     # ZustandçŠ¶æ€
â”‚   â”œâ”€â”€ authStore.ts
â”‚   â”œâ”€â”€ portfolioStore.ts
â”‚   â””â”€â”€ agentStore.ts
â”‚
â”œâ”€â”€ api/                        # APIè°ƒç”¨
â”‚   â”œâ”€â”€ client.ts               # Axiosé…ç½®
â”‚   â”œâ”€â”€ auth.ts
â”‚   â”œâ”€â”€ portfolio.ts
â”‚   â””â”€â”€ agents.ts
â”‚
â””â”€â”€ types/                      # TypeScriptç±»å‹
    â”œâ”€â”€ agent.ts
    â”œâ”€â”€ portfolio.ts
    â””â”€â”€ strategy.ts
```

---

## äºŒã€ä»£ç é£æ ¼è§„èŒƒ

### 2.1 Pythonä»£ç è§„èŒƒ

**éµå¾ª**: PEP 8 + Blackæ ¼å¼åŒ–

**å‘½åè§„èŒƒ**:
```python
# ç±»å: PascalCase
class MacroAgent:
    pass

# å‡½æ•°/å˜é‡: snake_case
def calculate_conviction_score():
    user_id = "123"
    
# å¸¸é‡: UPPER_SNAKE_CASE
MAX_RETRIES = 3
LLM_TIMEOUT = 10

# ç§æœ‰æ–¹æ³•: _å‰ç¼€
def _internal_helper():
    pass
```

**ç±»å‹æ³¨è§£ï¼ˆå¿…é¡»ï¼‰**:
```python
from typing import Optional, List, Dict

async def get_user_portfolio(
    user_id: str,
    include_history: bool = False
) -> Dict[str, Any]:
    """
    è·å–ç”¨æˆ·æŠ•èµ„ç»„åˆ
    
    Args:
        user_id: ç”¨æˆ·ID
        include_history: æ˜¯å¦åŒ…å«å†å²è®°å½•
        
    Returns:
        æŠ•èµ„ç»„åˆæ•°æ®å­—å…¸
        
    Raises:
        ValueError: ç”¨æˆ·ä¸å­˜åœ¨æ—¶
    """
    pass
```

**Docstringï¼ˆå¿…é¡»ï¼‰**:
- æ‰€æœ‰å…¬å¼€å‡½æ•°å¿…é¡»æœ‰docstring
- ä½¿ç”¨Googleé£æ ¼
- åŒ…å«Argsã€Returnsã€Raises

### 2.2 TypeScriptä»£ç è§„èŒƒ

**å‘½åè§„èŒƒ**:
```typescript
// æ¥å£: PascalCase + Iå‰ç¼€ï¼ˆå¯é€‰ï¼‰
interface AgentScore {
  score: number;
  confidence: number;
}

// ç±»å‹: PascalCase
type Strategy = {
  id: string;
  name: string;
}

// å‡½æ•°/å˜é‡: camelCase
const calculatePnL = (trades: Trade[]) => {}

// ç»„ä»¶: PascalCase
const Dashboard = () => {}

// å¸¸é‡: UPPER_SNAKE_CASE
const MAX_RETRIES = 3
```

**ç±»å‹æ³¨è§£ï¼ˆå¿…é¡»ï¼‰**:
```typescript
// å‡½æ•°å‚æ•°å’Œè¿”å›å€¼å¿…é¡»æ ‡æ³¨ç±»å‹
async function fetchAgentScores(
  strategyId: string
): Promise<AgentScoresResponse> {
  // ...
}

// é¿å…ä½¿ç”¨any
const data: unknown = await response.json()
```

---

## ä¸‰ã€Gitå·¥ä½œæµ

### 3.1 åˆ†æ”¯ç®¡ç†

**ä¸»åˆ†æ”¯**:
- `main`: ç”Ÿäº§ç¯å¢ƒ
- `develop`: å¼€å‘ç¯å¢ƒ

**åŠŸèƒ½åˆ†æ”¯**:
- `feature/agent-macro`: æ–°åŠŸèƒ½
- `fix/portfolio-bug`: Bugä¿®å¤
- `hotfix/llm-timeout`: ç´§æ€¥ä¿®å¤

**å‘½åè§„èŒƒ**:
```
<type>/<description>

ç±»å‹:
- feature: æ–°åŠŸèƒ½
- fix: Bugä¿®å¤
- refactor: é‡æ„
- docs: æ–‡æ¡£
- test: æµ‹è¯•
- chore: æ„å»º/å·¥å…·
```

### 3.2 Commitè§„èŒƒ

**æ ¼å¼**: `<type>(<scope>): <subject>`

**ç¤ºä¾‹**:
```bash
feat(agents): æ·»åŠ MacroAgentå®è§‚åˆ†æåŠŸèƒ½
fix(portfolio): ä¿®å¤P&Lè®¡ç®—é”™è¯¯
refactor(api): ä¼˜åŒ–Agent ScoreæŸ¥è¯¢æ€§èƒ½
docs(architecture): æ›´æ–°æ¶æ„æ–‡æ¡£
test(agents): æ·»åŠ MacroAgentå•å…ƒæµ‹è¯•
```

**ç±»å‹è¯´æ˜**:
- `feat`: æ–°åŠŸèƒ½
- `fix`: Bugä¿®å¤
- `refactor`: é‡æ„
- `docs`: æ–‡æ¡£
- `test`: æµ‹è¯•
- `chore`: æ„å»º/å·¥å…·
- `perf`: æ€§èƒ½ä¼˜åŒ–

### 3.3 PRæµç¨‹

1. **åˆ›å»ºåˆ†æ”¯**: ä»`develop`æ‹‰å–
2. **å¼€å‘**: ç¼–å†™ä»£ç +æµ‹è¯•
3. **è‡ªæ£€**: è¿è¡Œlintå’Œæµ‹è¯•
4. **æäº¤PR**: å¡«å†™PRæ¨¡æ¿
5. **Code Review**: è‡³å°‘1äººå®¡æ ¸
6. **åˆå¹¶**: Squash mergeåˆ°`develop`

**PRæ¨¡æ¿**:
```markdown
## å˜æ›´å†…å®¹
- æ·»åŠ MacroAgentå®è§‚ç»æµåˆ†æåŠŸèƒ½

## æµ‹è¯•
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] æ‰‹åŠ¨æµ‹è¯•éªŒè¯

## æˆªå›¾/å½•å±
ï¼ˆå¦‚æœ‰UIå˜æ›´ï¼‰

## ç›¸å…³Issue
Closes #123
```

---

## å››ã€æµ‹è¯•ç­–ç•¥

### 4.1 æµ‹è¯•é‡‘å­—å¡”

```
       /\
      /  \  E2Eæµ‹è¯•ï¼ˆ10%ï¼‰
     /â”€â”€â”€â”€\
    /      \  é›†æˆæµ‹è¯•ï¼ˆ30%ï¼‰
   /â”€â”€â”€â”€â”€â”€â”€â”€\
  /          \  å•å…ƒæµ‹è¯•ï¼ˆ60%ï¼‰
 /____________\
```

### 4.2 å•å…ƒæµ‹è¯•è§„èŒƒ

**æµ‹è¯•æ¡†æ¶**:
- åç«¯: pytest
- å‰ç«¯: Vitest

**å‘½åè§„èŒƒ**:
```python
# test_<module>.py
def test_calculate_conviction_score_with_valid_input():
    """æµ‹è¯•æ­£å¸¸è¾“å…¥ä¸‹çš„Convictionè®¡ç®—"""
    result = calculate_conviction_score(0.8, 0.7, 0.5)
    assert result == 72.0

def test_calculate_conviction_score_with_negative_input():
    """æµ‹è¯•è´Ÿæ•°è¾“å…¥çš„å¤„ç†"""
    result = calculate_conviction_score(-0.5, 0.3, 0.2)
    assert 0 <= result <= 100
```

**è¦†ç›–ç‡è¦æ±‚**:
- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘: >80%
- Agentå®ç°: >70%
- APIè·¯ç”±: >60%

**è¿è¡Œå‘½ä»¤**:
```bash
# åç«¯
pytest tests/ --cov=app --cov-report=html

# å‰ç«¯
npm run test:coverage
```

### 4.3 é›†æˆæµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
```python
async def test_strategy_execution_workflow():
    """æµ‹è¯•å®Œæ•´ç­–ç•¥æ‰§è¡Œæµç¨‹"""
    # 1. å‡†å¤‡æµ‹è¯•æ•°æ®
    market_data = create_mock_market_data()
    
    # 2. æ‰§è¡Œç­–ç•¥
    result = await execute_strategy("hodl-wave", market_data)
    
    # 3. éªŒè¯ç»“æœ
    assert result.signal in ["BUY", "SELL", "HOLD"]
    assert 0 <= result.conviction_score <= 100
    
    # 4. éªŒè¯æ•°æ®åº“
    trade = await get_latest_trade()
    assert trade.strategy_id == "hodl-wave"
```

### 4.4 E2Eæµ‹è¯•ï¼ˆç®€åŒ–ï¼‰

**å·¥å…·**: Playwrightï¼ˆæœªæ¥ï¼‰

**å…³é”®åœºæ™¯**:
- ç”¨æˆ·ç™»å½• â†’ æŸ¥çœ‹Dashboard â†’ è®¢é˜…ç­–ç•¥
- å®æ—¶æ¥æ”¶Agent Scoreæ›´æ–°
- æŸ¥çœ‹äº¤æ˜“å†å²

---

## äº”ã€ä»£ç å®¡æŸ¥æ¸…å•

### 5.1 åŠŸèƒ½æ€§

- [ ] åŠŸèƒ½æ˜¯å¦ç¬¦åˆéœ€æ±‚ï¼Ÿ
- [ ] è¾¹ç•Œæ¡ä»¶æ˜¯å¦å¤„ç†ï¼Ÿ
- [ ] é”™è¯¯å¤„ç†æ˜¯å¦å®Œå–„ï¼Ÿ
- [ ] æ˜¯å¦æœ‰å•å…ƒæµ‹è¯•ï¼Ÿ

### 5.2 æ€§èƒ½

- [ ] æ˜¯å¦æœ‰N+1æŸ¥è¯¢ï¼Ÿ
- [ ] æ˜¯å¦æœ‰ä¸å¿…è¦çš„å¾ªç¯ï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨äº†ç¼“å­˜ï¼Ÿ
- [ ] å¤§æ•°æ®é‡æ˜¯å¦åˆ†é¡µï¼Ÿ

### 5.3 å®‰å…¨æ€§

- [ ] æ˜¯å¦éªŒè¯ç”¨æˆ·è¾“å…¥ï¼Ÿ
- [ ] æ˜¯å¦æœ‰SQLæ³¨å…¥é£é™©ï¼Ÿ
- [ ] æ•æ„Ÿä¿¡æ¯æ˜¯å¦åŠ å¯†ï¼Ÿ
- [ ] APIæ˜¯å¦æœ‰æƒé™æ§åˆ¶ï¼Ÿ

### 5.4 å¯ç»´æŠ¤æ€§

- [ ] å˜é‡å‘½åæ˜¯å¦æ¸…æ™°ï¼Ÿ
- [ ] æ˜¯å¦æœ‰å¿…è¦çš„æ³¨é‡Šï¼Ÿ
- [ ] å‡½æ•°æ˜¯å¦è¿‡é•¿ï¼ˆ>50è¡Œï¼‰ï¼Ÿ
- [ ] æ˜¯å¦éµå¾ªå•ä¸€èŒè´£ï¼Ÿ

---

## å…­ã€ç¯å¢ƒç®¡ç†

### 6.1 ç¯å¢ƒåˆ’åˆ†

| ç¯å¢ƒ | ç”¨é€” | åˆ†æ”¯ | æ•°æ®åº“ |
|-----|------|------|--------|
| **Local** | æœ¬åœ°å¼€å‘ | feature/* | SQLite |
| **Development** | é›†æˆæµ‹è¯• | develop | PostgreSQL(Dev) |
| **Staging** | é¢„å‘å¸ƒ | release/* | PostgreSQL(Staging) |
| **Production** | ç”Ÿäº§ | main | PostgreSQL(Prod) |

### 6.2 ç¯å¢ƒå˜é‡ç®¡ç†

**ä¸åŒç¯å¢ƒé…ç½®**:
```bash
# .env.local
DATABASE_URL=sqlite:///./app.db
REDIS_URL=redis://localhost:6379
CLAUDE_API_KEY=sk-ant-...

# .env.production
DATABASE_URL=postgresql://user:pass@prod-db:5432/automoney
REDIS_URL=redis://prod-redis:6379
CLAUDE_API_KEY=sk-ant-prod-...
```

**å®‰å…¨è§„èŒƒ**:
- âŒ ç¦æ­¢æäº¤`.env`æ–‡ä»¶åˆ°Git
- âœ… æä¾›`.env.example`æ¨¡æ¿
- âœ… ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç¯å¢ƒå˜é‡

---

## ä¸ƒã€æ—¥å¿—è§„èŒƒ

### 7.1 æ—¥å¿—çº§åˆ«

| çº§åˆ« | ç”¨é€” | ç¤ºä¾‹ |
|-----|------|------|
| **DEBUG** | å¼€å‘è°ƒè¯• | "Agent input data: {...}" |
| **INFO** | æ­£å¸¸æµç¨‹ | "Strategy executed successfully" |
| **WARNING** | è­¦å‘Šä¿¡æ¯ | "Cache miss, querying database" |
| **ERROR** | é”™è¯¯ä¿¡æ¯ | "LLM API call failed" |
| **CRITICAL** | ä¸¥é‡é”™è¯¯ | "Database connection lost" |

### 7.2 æ—¥å¿—æ ¼å¼

```python
import logging

logger = logging.getLogger(__name__)

# ç»“æ„åŒ–æ—¥å¿—
logger.info(
    "strategy_executed",
    extra={
        "strategy_id": "hodl-wave",
        "user_id": "user_123",
        "conviction_score": 75,
        "signal": "BUY",
        "execution_time_ms": 4500
    }
)
```

### 7.3 æ•æ„Ÿä¿¡æ¯å¤„ç†

**ç¦æ­¢è®°å½•**:
- âŒ JWT Token
- âŒ API Key
- âŒ ç”¨æˆ·å¯†ç 

**è„±æ•å¤„ç†**:
```python
logger.info(f"User {user_id[:8]}*** logged in")  # ä»…æ˜¾ç¤ºå‰8ä½
logger.info(f"API call with key ***{api_key[-4:]}")  # ä»…æ˜¾ç¤ºå4ä½
```

---

## å…«ã€æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ

### 8.1 æ•°æ®åº“æŸ¥è¯¢

**ä½¿ç”¨**:
```python
# âœ… ä½¿ç”¨select_relatedé¿å…N+1
trades = (
    await db.query(Trade)
    .options(selectinload(Trade.portfolio))
    .filter(Trade.user_id == user_id)
    .all()
)

# âœ… ä½¿ç”¨åˆ†é¡µ
trades = (
    await db.query(Trade)
    .offset(offset)
    .limit(20)
    .all()
)

# âœ… ä½¿ç”¨ç´¢å¼•
# åœ¨modelä¸­å®šä¹‰
class Trade(Base):
    __table_args__ = (
        Index('idx_user_timestamp', 'user_id', 'timestamp'),
    )
```

**é¿å…**:
```python
# âŒ N+1æŸ¥è¯¢
trades = await db.query(Trade).all()
for trade in trades:
    portfolio = await db.query(Portfolio).get(trade.portfolio_id)  # æ¯æ¬¡æŸ¥è¯¢
```

### 8.2 ç¼“å­˜ç­–ç•¥

```python
from functools import lru_cache
from app.core.cache import redis_cache

# å†…å­˜ç¼“å­˜ï¼ˆå°æ•°æ®ï¼‰
@lru_cache(maxsize=128)
def get_strategy_config(strategy_id: str) -> dict:
    return load_strategy_config(strategy_id)

# Redisç¼“å­˜ï¼ˆå¤§æ•°æ®/å…±äº«æ•°æ®ï¼‰
@redis_cache(ttl=3600)
async def get_market_data(asset: str) -> dict:
    return await fetch_from_api(asset)
```

### 8.3 å¼‚æ­¥ä¼˜åŒ–

```python
# âœ… å¹¶è¡Œè°ƒç”¨ç‹¬ç«‹API
async def collect_all_data():
    results = await asyncio.gather(
        fetch_binance_price(),
        fetch_glassnode_data(),
        fetch_fear_index(),
        return_exceptions=True  # å•ä¸ªå¤±è´¥ä¸å½±å“æ•´ä½“
    )
    return results

# âŒ ä¸²è¡Œè°ƒç”¨
async def collect_all_data():
    price = await fetch_binance_price()
    onchain = await fetch_glassnode_data()
    fear = await fetch_fear_index()
```

---

## ä¹ã€å®‰å…¨æœ€ä½³å®è·µ

### 9.1 è¾“å…¥éªŒè¯

```python
from pydantic import BaseModel, validator

class TradeRequest(BaseModel):
    asset: str
    quantity: float
    
    @validator('asset')
    def validate_asset(cls, v):
        allowed = ['BTC', 'ETH']
        if v not in allowed:
            raise ValueError(f'Asset must be one of {allowed}')
        return v
    
    @validator('quantity')
    def validate_quantity(cls, v):
        if v <= 0 or v > 10:
            raise ValueError('Quantity must be between 0 and 10')
        return v
```

### 9.2 SQLæ³¨å…¥é˜²æŠ¤

```python
# âœ… ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
result = await db.execute(
    "SELECT * FROM trades WHERE user_id = :user_id",
    {"user_id": user_id}
)

# âŒ å­—ç¬¦ä¸²æ‹¼æ¥
result = await db.execute(
    f"SELECT * FROM trades WHERE user_id = '{user_id}'"  # å±é™©ï¼
)
```

### 9.3 APIé™æµ

```python
from slowapi import Limiter
from slowapi.util import get_remote_address

limiter = Limiter(key_func=get_remote_address)

@app.get("/api/v1/agents/scores")
@limiter.limit("60/hour")  # æ¯å°æ—¶60æ¬¡
async def get_agent_scores():
    pass
```

---

## åã€ç›‘æ§ä¸å‘Šè­¦

### 10.1 æ€§èƒ½ç›‘æ§

**å…³é”®æŒ‡æ ‡**:
```python
import time
from prometheus_client import Counter, Histogram

# è¯·æ±‚è®¡æ•°
api_requests = Counter(
    'api_requests_total',
    'Total API requests',
    ['method', 'endpoint', 'status']
)

# å»¶è¿Ÿåˆ†å¸ƒ
api_latency = Histogram(
    'api_latency_seconds',
    'API latency',
    ['endpoint']
)

# ä½¿ç”¨
@app.get("/api/v1/portfolio")
async def get_portfolio():
    start = time.time()
    try:
        result = await fetch_portfolio()
        api_requests.labels('GET', '/portfolio', '200').inc()
        return result
    finally:
        api_latency.labels('/portfolio').observe(time.time() - start)
```

### 10.2 é”™è¯¯è¿½è¸ª

**é›†æˆSentry**:
```python
import sentry_sdk

sentry_sdk.init(
    dsn="https://...@sentry.io/...",
    environment="production",
    traces_sample_rate=0.1  # é‡‡æ ·10%è¯·æ±‚
)

# è‡ªåŠ¨æ•è·å¼‚å¸¸
@app.get("/api/v1/agents/scores")
async def get_agent_scores():
    try:
        return await fetch_scores()
    except Exception as e:
        sentry_sdk.capture_exception(e)
        raise
```

---

**ğŸ“Œ å…³é”®Takeaway**: 
- ç»Ÿä¸€ä»£ç é£æ ¼æå‡å¯è¯»æ€§
- æµ‹è¯•è¦†ç›–ç‡>70%ä¿è¯è´¨é‡
- Code Reviewå¼ºåˆ¶æ‰§è¡Œ
- ç›‘æ§å‘Šè­¦åŠæ—¶å‘ç°é—®é¢˜

**å®Œæˆ**: æ‰€æœ‰æ¶æ„æ–‡æ¡£å·²å®Œæˆï¼ğŸ‰


