# AutoMoney 项目总览（优化版）

> 版本: 2.0  
> 更新日期: 2025-11-05  
> 架构师: AI Assistant  
> 状态: 架构设计阶段

---

## 📋 目录导航

本架构文档分为以下模块：

| 文档 | 描述 | 适合阅读对象 |
|-----|------|------------|
| **00-项目总览.md** (本文档) | 项目概述、技术栈、成本 | 所有人 |
| **01-技术选型详解.md** | 为什么选这些技术？对比分析 | 技术决策者 |
| **02-Multi-Agent架构设计.md** | 三层Agent架构核心逻辑 | 后端开发者 |
| **03-数据流与调度机制.md** | 数据如何流转、任务如何触发 | 后端开发者 |
| **04-数据库设计方案.md** | 表结构、索引、时序数据 | 后端/DBA |
| **05-API与实时通信.md** | REST API + WebSocket设计 | 前后端开发者 |
| **06-部署与运维方案.md** | Docker、云端部署、监控 | DevOps |
| **07-开发规范与最佳实践.md** | 代码规范、测试策略 | 全体开发者 |
| **08-成本优化与扩展路线.md** | 成本控制、未来规划 | 技术决策者/产品 |

---

## 一、项目定位

### 1.1 产品愿景

**AutoMoney** - 让AI帮你做加密货币投资决策的智能平台

**核心价值主张**：
- 🤖 **AI驱动决策**: 不是人工看K线，而是3个专业AI Agent 24小时分析市场
- 📊 **透明化过程**: 每个决策都能看到AI的推理过程（不是黑盒）
- 🔒 **零风险验证**: Paper Trading模拟交易，看到策略效果再决定是否实盘
- 🚀 **自动化执行**: 设置好策略后，AI自动执行，无需盯盘

**目标用户**：
1. **初级投资者**: 不懂技术分析，想借助AI辅助决策
2. **忙碌的专业人士**: 没时间盯盘，希望AI自动化执行
3. **量化交易爱好者**: 想测试多策略组合效果

**非目标用户**：
- ❌ 追求暴富的赌徒（我们强调风险控制）
- ❌ 超高频交易者（我们最快10分钟级策略）
- ❌ 需要实盘API连接的专业机构（初期仅Paper Trading）

---

## 二、核心功能地图

```
┌─────────────────────────────────────────────────────────────┐
│                    AutoMoney 功能架构                        │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────┐
│  1. 用户系统        │
├─────────────────────┤
│ • Google一键登录    │
│ • 用户数据隔离      │
│ • 投资组合管理      │
└─────────────────────┘
         ↓
┌─────────────────────────────────────────────────────────────┐
│  2. Multi-Agent 决策引擎（核心）                             │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌────────────────┐    ┌────────────────┐                   │
│  │  系统层        │ ←─ │  用户对话时    │                   │
│  │  SuperAgent    │    │  才触发        │                   │
│  └────────────────┘    └────────────────┘                   │
│         ↓                                                     │
│  ┌─────────────────────────────────────────┐                │
│  │  分析层（核心）                          │                │
│  ├─────────────────────────────────────────┤                │
│  │  MacroAgent    OnChainAgent   TAAgent   │                │
│  │  宏观经济      链上数据        技术分析  │                │
│  │  权重40%       权重40%         权重20%   │                │
│  └─────────────────────────────────────────┘                │
│         ↓                                                     │
│  ┌─────────────────────────────────────────┐                │
│  │  决策层                                  │                │
│  ├─────────────────────────────────────────┤                │
│  │  Conviction Score 计算                  │                │
│  │  Signal 生成 (BUY/SELL/HOLD)            │                │
│  │  Risk Management 熔断                   │                │
│  └─────────────────────────────────────────┘                │
└─────────────────────────────────────────────────────────────┘
         ↓
┌─────────────────────┐
│  3. 策略系统        │
├─────────────────────┤
│ • 硬编码策略模板    │
│ • 多周期支持        │
│   (10分钟-4小时)    │
│ • 用户订阅/暂停     │
└─────────────────────┘
         ↓
┌─────────────────────┐
│  4. Paper Trading   │
├─────────────────────┤
│ • 模拟订单执行      │
│ • 实时P&L计算       │
│ • 交易历史追踪      │
└─────────────────────┘
         ↓
┌─────────────────────┐
│  5. 数据可视化      │
├─────────────────────┤
│ • Exploration Hub   │
│   (实时Agent Score) │
│ • Portfolio Dashboard│
│ • Strategy Market   │
│ • WebSocket实时推送 │
└─────────────────────┘
```

---

## 三、技术栈概览

### 3.1 前端技术栈（保持现有）

| 技术 | 版本 | 用途 |
|-----|------|------|
| **React** | 18.3.1 | UI框架 |
| **TypeScript** | 5.x | 类型安全 |
| **Vite** | 6.3.5 | 构建工具 |
| **Tailwind CSS** | 3.x | 样式 |
| **Zustand** | 最新 | 状态管理 |
| **TanStack Query** | 最新 | 服务端状态 |
| **Socket.io-client** | 最新 | WebSocket |
| **Recharts** | 2.15.2 | 图表 |

### 3.2 后端技术栈（核心）

| 技术 | 版本 | 用途 | 选择理由 |
|-----|------|------|---------|
| **Python** | 3.11+ | 编程语言 | AI/ML生态强大 |
| **FastAPI** | 0.109+ | Web框架 | 高性能、易学 |
| **SQLAlchemy** | 2.0+ | ORM | 成熟、灵活 |
| **Pydantic** | 2.0+ | 数据验证 | 类型安全 |
| **LangGraph** | 最新 | Agent编排 | 专为多Agent设计 |
| **LangChain** | 最新 | LLM调用 | 标准化接口 |
| **APScheduler** | 最新 | 任务调度 | 轻量、够用 |
| **Socket.io** | 最新 | WebSocket | 双向通信 |

### 3.3 数据存储

| 技术 | 用途 | 数据类型 |
|-----|------|---------|
| **PostgreSQL 16** | 主数据库 | 用户、策略、交易 |
| **TimescaleDB扩展** | 时序数据 | K线、Agent记录 |
| **SQLite** | 本地开发 | 开发环境快速启动 |
| **Redis 7.x** | 缓存+队列 | API缓存、会话、消息队列 |

### 3.4 AI/LLM服务（混合方案）

| 场景 | 模型 | 成本 | 用途 |
|-----|------|------|------|
| **系统层** | GPT-4o-mini | $0.15/MTok | 意图识别（便宜） |
| **分析层** | Claude 3.5 Sonnet | $3/MTok | 复杂分析（质量） |
| **决策层** | GPT-4o | $2.5/MTok | 关键决策（稳定） |
| **降级备份** | Claude Haiku | $0.25/MTok | API故障时降级 |

**为什么混合？**
1. **成本优化**: 不同任务用不同价位模型，节省25-40%
2. **可靠性**: 多提供商备份，避免单点故障
3. **灵活性**: 可随时调整各层模型，A/B测试

### 3.5 数据源API

| 数据类型 | API | 成本 | 优先级 |
|---------|-----|------|--------|
| **现货价格** | Binance Public | 免费 | P0 |
| **链上数据** | Glassnode Starter | $29/月 | P0 |
| **情绪指数** | Alternative.me | 免费 | P0 |
| **宏观数据** | FRED API | 免费 | P1 |
| **ETF流量** | CoinGlass | $100/月 | P2（后期） |

---

## 四、关键架构决策

### 4.1 为什么选Python而不是NestJS？

**决策**: Python + FastAPI ✅

**理由**:
1. **AI生态**: pandas、numpy等库是交易策略的基础
2. **开发效率**: FastAPI比NestJS简单30%，适合快速MVP
3. **成本**: Python工程师薪资比TypeScript全栈低20%
4. **未来扩展**: 可能接入本地ML模型（如价格预测）

**Trade-off**:
- ❌ 前后端类型不共享（需手动维护接口）
- ✅ AI/数据处理更自然

### 4.2 为什么选LangGraph而不是自研？

**决策**: LangGraph ✅

**理由**:
1. **节省时间**: 自研Agent编排至少2-3周，LangGraph开箱即用
2. **可靠性**: 开源社区验证，bug更少
3. **可视化**: 内置工作流图，便于调试
4. **未来兼容**: 可无缝接入LangSmith监控

**Trade-off**:
- ❌ 依赖外部库（但LangChain很稳定）
- ✅ 社区活跃，文档丰富

### 4.3 为什么APScheduler而不是Celery？

**决策**: APScheduler（初期），Celery（>500用户后）

**理由**:
1. **简单**: 无需额外Worker进程，配置少
2. **够用**: 支持cron、interval、date触发
3. **资源**: Redis仅做缓存，不做消息队列

**Trade-off**:
- ❌ 不支持分布式（单机限制）
- ✅ 初期100用户完全够用

---

## 五、成本估算

### 5.1 开发成本

| 阶段 | 工时 | 说明 |
|-----|------|------|
| **Phase 1: MVP** | 150-200h | 基础架构+第一个策略 |
| **Phase 2: 优化** | 60-80h | 用户体验提升 |
| **Phase 3: 上线** | 40-60h | 测试+部署 |
| **总计** | **250-340h** | 约1.5-2个月全职 |

**对比**: NestJS方案预估340-500h（多60-160h）

### 5.2 运营成本（月度）

#### 场景1: 初期测试（10用户）

| 项目 | 成本 | 说明 |
|-----|------|------|
| LLM API | **$50** | 混合方案：$5/用户×10 |
| Glassnode | $29 | 共享给所有用户 |
| Railway | $20 | 后端+数据库 |
| Vercel | $0 | Hobby免费 |
| **合计** | **$99/月** | vs NestJS方案$125/月 |

#### 场景2: 小规模运营（100用户）

| 项目 | 成本 |
|-----|------|
| LLM API | $500 |
| Glassnode | $29 |
| CoinGlass | $100 |
| Railway | $50 |
| **合计** | **$679/月** |

**收支平衡点**: $10/月订阅费 × 68用户

#### 场景3: 成熟产品（1000用户）

| 项目 | 成本 |
|-----|------|
| LLM API | $5,000 |
| 数据API | $500 |
| 云服务 | $200 |
| **合计** | **$5,700/月** |

**收支平衡点**: $10/月 × 570用户

---

## 六、项目里程碑

### Phase 1: MVP基础（6周）

**目标**: 完成第一个策略的完整闭环

**Week 1-2: 基础设施**
- [ ] FastAPI项目初始化
- [ ] PostgreSQL + Redis Docker配置
- [ ] Google OAuth集成
- [ ] 前端Zustand状态管理

**Week 3-4: Agent核心**
- [ ] LangGraph工作流搭建
- [ ] MacroAgent实现
- [ ] OnChainAgent实现
- [ ] TAAgent实现

**Week 5-6: 决策与交易**
- [ ] Conviction Calculator
- [ ] Signal Generator
- [ ] Paper Trading引擎
- [ ] WebSocket实时推送

**交付物**: 
- 用户可登录
- 看到实时Agent Score
- 模拟交易执行
- 查看P&L

### Phase 2: 用户体验（3周）

- Dashboard优化
- 策略性能图表
- SuperAgent对话功能
- API性能优化

### Phase 3: 生产就绪（2周）

- 单元测试覆盖率>80%
- 压力测试
- 监控告警
- 生产环境部署

**总计**: 11周（约2.5个月）

---

## 七、风险评估

| 风险 | 等级 | 影响 | 缓解措施 |
|-----|------|------|---------|
| **LLM成本失控** | 🔴 高 | 月成本>预算50% | 设置调用上限、缓存策略、用户配额 |
| **Claude API故障** | 🟡 中 | 服务中断2-4h | 自动降级到GPT-4o |
| **数据源限流** | 🟡 中 | 分析延迟 | Redis缓存、多源降级 |
| **策略效果不佳** | 🟡 中 | 用户流失 | 免责声明、Paper Trading验证 |
| **法律合规** | 🟡 中 | 被要求整改 | 仅模拟交易、咨询律师 |

---

## 八、成功指标

### 技术指标（MVP阶段）

| 指标 | 目标 |
|-----|------|
| API响应时间 | P95 < 500ms |
| Agent分析耗时 | < 15s（3个并行） |
| WebSocket延迟 | < 100ms |
| 单元测试覆盖率 | > 80% |
| 可用性 | > 99% |

### 产品指标（3个月）

| 指标 | 目标 |
|-----|------|
| 注册用户 | 100 |
| 月活跃 | 30 |
| 策略订阅率 | 50% |
| 7日留存 | 20% |

### 业务指标（6个月）

| 指标 | 目标 |
|-----|------|
| 付费用户 | 50 |
| MRR | $500 |
| LTV/CAC | > 6 |

---

## 九、下一步阅读

建议按以下顺序阅读架构文档：

1. **技术决策者**: 
   - 01-技术选型详解.md（了解为什么选这些技术）
   - 08-成本优化与扩展路线.md（商业可行性）

2. **后端开发者**:
   - 02-Multi-Agent架构设计.md（核心逻辑）
   - 03-数据流与调度机制.md（数据流转）
   - 04-数据库设计方案.md（表结构）

3. **前端开发者**:
   - 05-API与实时通信.md（接口文档）

4. **DevOps**:
   - 06-部署与运维方案.md（部署流程）

5. **全体开发者**:
   - 07-开发规范与最佳实践.md（代码规范）

---

## 十、关键联系人

| 角色 | 职责 | 联系方式 |
|-----|------|---------|
| **产品负责人** | 需求定义、优先级 | TBD |
| **技术负责人** | 架构决策、Code Review | TBD |
| **后端Leader** | Agent开发、API设计 | TBD |
| **前端Leader** | UI实现、状态管理 | TBD |
| **DevOps** | 部署、监控、成本优化 | TBD |

---

## 附录A: 名词解释

| 术语 | 解释 |
|-----|------|
| **Paper Trading** | 模拟交易，用虚拟资金测试策略，不影响真实资金 |
| **Agent** | 一个独立的AI智能体，有特定职责（如分析宏观数据） |
| **Conviction Score** | 信念分数（0-100），表示AI对市场方向的确信程度 |
| **LLM** | Large Language Model，大语言模型（如GPT、Claude） |
| **P&L** | Profit & Loss，盈亏 |
| **MRR** | Monthly Recurring Revenue，月度经常性收入 |
| **LTV/CAC** | 用户生命周期价值 / 获客成本 |

---

**📝 文档维护**: 本文档每月更新一次，记录架构演进和关键决策变更。

**🔄 版本历史**:
- v2.0 (2025-11-05): 优化版架构，Python+FastAPI+LangGraph
- v1.0 (2025-11-05): 初版架构，NestJS方案


