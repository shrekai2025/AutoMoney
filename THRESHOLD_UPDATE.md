# ä¸‹å•é˜ˆå€¼è°ƒæ•´è¯´æ˜

## ğŸ“… æ›´æ–°æ—¶é—´
2025-11-08

## ğŸ¯ æ›´æ–°å†…å®¹

### æ—§é€»è¾‘
| Conviction Score | ä¿¡å· | ä»“ä½ | è¯´æ˜ |
|-----------------|------|------|------|
| < 20 | SELL | 1% | é˜²å¾¡æ€§å‡ä»“ |
| 20-40 | SELL | 100% | å®Œå…¨æ¸…ä»“ |
| 40-70 | HOLD | 0% | æŒå¸è§‚æœ› |
| â‰¥ 70 | BUY | 0.2%-0.5% | ä¹°å…¥ |

### æ–°é€»è¾‘
| Conviction Score | ä¿¡å· | ä»“ä½ | è¯´æ˜ |
|-----------------|------|------|------|
| < 45 | SELL | 100% | å…¨éƒ¨æ¸…ä»“ |
| 45-50 | SELL | 0%-50% | éƒ¨åˆ†å‡ä»“ï¼ˆåŠ¨æ€ï¼‰ |
| â‰¥ 50 | BUY | 0.2%-0.5% | ä¹°å…¥ |

## ğŸ“Š éƒ¨åˆ†å‡ä»“è¯¦ç»†è¯´æ˜

45-50åŒºé—´é‡‡ç”¨**çº¿æ€§åŠ¨æ€å‡ä»“**ç­–ç•¥ï¼š

| Score | å–å‡ºæ¯”ä¾‹ | è®¡ç®—å…¬å¼ |
|-------|---------|---------|
| 45.0 | 50% | (50-45)/5 Ã— 50% = 50% |
| 46.0 | 40% | (50-46)/5 Ã— 50% = 40% |
| 47.0 | 30% | (50-47)/5 Ã— 50% = 30% |
| 47.5 | 25% | (50-47.5)/5 Ã— 50% = 25% |
| 48.0 | 20% | (50-48)/5 Ã— 50% = 20% |
| 49.0 | 10% | (50-49)/5 Ã— 50% = 10% |
| 49.5 | 5% | (50-49.5)/5 Ã— 50% = 5% |
| 49.9 | 1% | (50-49.9)/5 Ã— 50% = 1% |
| 50.0 | 0% | å¼€å§‹ä¹°å…¥ |

**å…¬å¼**ï¼š
```python
if 45 <= conviction_score < 50:
    sell_ratio = (50 - conviction_score) / 5
    position_size = 0.5 * sell_ratio  # æœ€å¤šå–50%
```

## ğŸ”§ ä¿®æ”¹çš„æ–‡ä»¶

### 1. [signal_generator.py](AMbackend/app/services/decision/signal_generator.py)
**ä¿®æ”¹å†…å®¹**ï¼š
- æ›´æ–°é˜ˆå€¼å¸¸é‡ï¼ˆLine 71-73ï¼‰
- ä¿®æ”¹ä¿¡å·ç”Ÿæˆé€»è¾‘ï¼ˆLine 130-147ï¼‰
- è°ƒæ•´ä»“ä½è®¡ç®—é€»è¾‘ï¼ˆLine 271-279ï¼‰
- æ›´æ–°æ–‡æ¡£å­—ç¬¦ä¸²ï¼ˆLine 50-68ï¼‰

**å…³é”®ä»£ç **ï¼š
```python
# æ–°é˜ˆå€¼
FULL_SELL_THRESHOLD = 45       # < 45 å…¨éƒ¨æ¸…ä»“
PARTIAL_SELL_THRESHOLD = 50    # 45-50 éƒ¨åˆ†å‡ä»“
BUY_THRESHOLD = 50             # >= 50 ä¹°å…¥

# æ–°ä¿¡å·é€»è¾‘
if conviction_score >= self.BUY_THRESHOLD:
    signal = TradeSignal.BUY
    reasons.append(f"âœ… çœ‹å¤šä¹°å…¥ (ä¿¡å¿µåˆ†æ•°: {conviction_score:.1f}/100)")

elif conviction_score >= self.FULL_SELL_THRESHOLD:
    signal = TradeSignal.SELL
    reasons.append(f"ğŸŸ¡ éƒ¨åˆ†å‡ä»“ (ä¿¡å¿µåˆ†æ•°: {conviction_score:.1f}/100)")

else:
    signal = TradeSignal.SELL
    reasons.append(f"ğŸ”´ å…¨éƒ¨æ¸…ä»“ (ä¿¡å¿µåˆ†æ•°: {conviction_score:.1f}/100)")

# æ–°ä»“ä½è®¡ç®—
elif conviction_score >= self.FULL_SELL_THRESHOLD:
    # 45-50: éƒ¨åˆ†å‡ä»“
    sell_ratio = (self.PARTIAL_SELL_THRESHOLD - conviction_score) / 5
    return 0.5 * sell_ratio  # æœ€å¤šå–å‡º50%

else:
    # < 45: å…¨éƒ¨æ¸…ä»“
    return 1.0
```

### 2. [strategy_orchestrator.py](AMbackend/app/services/strategy/strategy_orchestrator.py)
**ä¿®æ”¹å†…å®¹**ï¼š
- æ›´æ–°è¿ç»­ä¿¡å·åˆ¤æ–­é€»è¾‘ï¼ˆLine 379-380ï¼‰

**å…³é”®ä»£ç **ï¼š
```python
# ä½¿ç”¨æ–°é˜ˆå€¼åˆ¤æ–­è¿ç»­ä¿¡å·
is_bullish = signal == TradeSignal.BUY and conviction_score >= SignalGenerator.BUY_THRESHOLD
is_bearish = signal == TradeSignal.SELL and conviction_score < SignalGenerator.FULL_SELL_THRESHOLD
```

## âœ… æµ‹è¯•ç»“æœ

è¿è¡Œæµ‹è¯•è„šæœ¬ `test_new_thresholds.py` éªŒè¯ï¼š

```bash
python test_new_thresholds.py
```

**æµ‹è¯•é€šè¿‡**ï¼š
- âœ… Score < 45: å…¨éƒ¨æ¸…ä»“ (100%)
- âœ… Score = 45: éƒ¨åˆ†å‡ä»“ (50%)
- âœ… Score = 47.5: éƒ¨åˆ†å‡ä»“ (25%)
- âœ… Score â‰ˆ 50: éƒ¨åˆ†å‡ä»“ (æ¥è¿‘0%)
- âœ… Score â‰¥ 50: ä¹°å…¥

## ğŸ“ˆ å®é™…æ¡ˆä¾‹

### ç¤ºä¾‹1ï¼šScore = 24 (åŸé—®é¢˜åœºæ™¯)
- **æ—§é€»è¾‘**: å®Œå…¨æ¸…ä»“ (100%)
- **æ–°é€»è¾‘**: å®Œå…¨æ¸…ä»“ (100%)
- **å˜åŒ–**: æ— å˜åŒ–

### ç¤ºä¾‹2ï¼šScore = 47
- **æ—§é€»è¾‘**: æŒå¸è§‚æœ› (0%)
- **æ–°é€»è¾‘**: éƒ¨åˆ†å‡ä»“ (30%)
- **å˜åŒ–**: åŸæœ¬ä¸æ“ä½œï¼Œç°åœ¨ä¼šå‡ä»“30%

### ç¤ºä¾‹3ï¼šScore = 60
- **æ—§é€»è¾‘**: æŒå¸è§‚æœ› (0%)
- **æ–°é€»è¾‘**: ä¹°å…¥ (0.26%)
- **å˜åŒ–**: åŸæœ¬ä¸æ“ä½œï¼Œç°åœ¨ä¼šä¹°å…¥

## ğŸ¯ ä¼˜åŠ¿

1. **æ›´çµæ•çš„é£é™©æ§åˆ¶**ï¼š45-50åŒºé—´ä¸å†å‚»ç­‰ï¼Œè€Œæ˜¯é€æ­¥å‡ä»“
2. **æ›´æ—©çš„ä¹°å…¥æ—¶æœº**ï¼šä»â‰¥70é™ä½åˆ°â‰¥50ï¼Œæ›´æ—©æ•æ‰ä¸Šæ¶¨è¶‹åŠ¿
3. **å¹³æ»‘çš„ä»“ä½è¿‡æ¸¡**ï¼šé¿å…çªç„¶çš„æ»¡ä»“/ç©ºä»“åˆ‡æ¢
4. **æ›´é«˜çš„èµ„é‡‘åˆ©ç”¨ç‡**ï¼šå‡å°‘æŒå¸è§‚æœ›æ—¶é—´

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä»“ä½æ£€æŸ¥**ï¼šSELLä¿¡å·ä»ç„¶éœ€è¦æŒä»“ â‰¥ 1% æ‰ä¼šæ‰§è¡Œ
2. **ç†”æ–­æœºåˆ¶**ï¼šæç«¯å¸‚åœºæ¡ä»¶ä¸‹ä»ä¼šæš‚åœäº¤æ˜“
3. **åŠ é€Ÿç§¯ç´¯**ï¼šè¿ç»­ä¿¡å·é˜ˆå€¼ä»70æ”¹ä¸º50
4. **å†å²æ•°æ®**ï¼šå·²æœ‰çš„æ‰§è¡Œè®°å½•ä¸å—å½±å“

## ğŸš€ éƒ¨ç½²æ­¥éª¤

1. âœ… ä»£ç å·²ä¿®æ”¹
2. âœ… æµ‹è¯•å·²é€šè¿‡
3. â³ é‡å¯åç«¯æœåŠ¡ä½¿æ›´æ”¹ç”Ÿæ•ˆï¼š
   ```bash
   ./stop.sh
   ./start.sh
   ```
4. â³ è§‚å¯Ÿä¸‹æ¬¡ç­–ç•¥æ‰§è¡Œç»“æœ

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–éœ€è¦è°ƒæ•´ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚
